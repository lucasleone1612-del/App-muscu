<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Elite Hybrid Training</title>
    
    <!-- PWA Settings -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#000000">
    <link rel="manifest" href='data:application/manifest+json;base64,eyJuYW1lIjoiRWxpdGUgSHlicmlkIFRyYWluaW5nIiwic2hvcnRfbmFtZSI6IkVsaXRlIEd5bSIsInN0YXJ0X3VybCI6Ii4iLCJkaXNwbGF5Ijoic3RhbmRhbG9uZSIsImJhY2tncm91bmRfY29xvciI6IiMwMDAwMDAiLCJ0aGVtZV9jb2xvciI6IiMwMDAwMDAiLCJpY29ucyI6W3sic3JjIjoiaHR0cHM6Ly9jZG4tanNkZWxpdnIubmV0L2doL2x1Y2lkZS1pY29ucy9sdWNpZGUvbG9nby5zdmciLCJzaXplcyI6IjUxMng1MTIiLCJ0eXBlIjoiaW1hZ2Uvc3ZnK3htbCJ9XX0='>

    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;700;900&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #000; color: #fff; -webkit-tap-highlight-color: transparent; }
        .animate-fadeIn { animation: fadeIn 0.5s ease-out; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        input[type="number"] { -moz-appearance: textfield; }
        
        /* Style du bouton de secours (caché par défaut) */
        #crash-recovery {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: #1e1e1e;
            padding: 30px;
            border-radius: 20px;
            border: 2px solid #ef4444;
            text-align: center;
            z-index: 9999;
            width: 90%;
            max-width: 400px;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <!-- Interface de Secours (Apparaît si React plante) -->
    <div id="crash-recovery">
        <h2 class="text-2xl font-bold text-white mb-4">⚠️ Problème détecté</h2>
        <p class="text-gray-400 mb-6 text-sm">Les données de votre téléphone semblent corrompues, ce qui empêche l'application de démarrer.</p>
        <button onclick="localStorage.clear(); window.location.reload();" class="w-full bg-red-600 text-white font-bold py-4 rounded-xl shadow-lg active:scale-95 transition-transform">
            RÉPARER L'APPLICATION
            <br><span class="text-xs font-normal opacity-80">(Réinitialiser les données)</span>
        </button>
    </div>

    <!-- Script de détection de crash -->
    <script>
        // Si au bout de 2.5 secondes, l'appli n'est pas chargée, on affiche le bouton de secours
        setTimeout(() => {
            const root = document.getElementById('root');
            if (!root.hasChildNodes()) {
                document.getElementById('crash-recovery').style.display = 'block';
            }
        }, 2500);

        if ('serviceWorker' in navigator) {
            // Changement de nom pour forcer le nettoyage du cache
            const CACHE_NAME = 'elite-gym-v12-rescue';
            self.addEventListener('install', e => self.skipWaiting());
            self.addEventListener('activate', e => e.waitUntil(caches.keys().then(keys => Promise.all(keys.map(k => k !== CACHE_NAME ? caches.delete(k) : null)))));
        }
    </script>

    <script type="module">
        import React, { useState, useEffect } from 'https://esm.sh/react@18.2.0';
        import { createRoot } from 'https://esm.sh/react-dom@18.2.0/client';
        import { 
            Save, Activity, TrendingUp, TrendingDown, Scale, Calendar, 
            ChevronDown, ChevronUp, BarChart2, Dumbbell, History, 
            Flame, BatteryCharging, ArrowRight,
            Plus, Trash2, X, Settings, Edit2, CheckCircle, Minus, Trophy, Database, Copy, Upload
        } from 'https://esm.sh/lucide-react@0.263.1';

        function App() {
            // -- RESTAURATION DONNÉES SÉCURISÉE (TRY/CATCH PARTOUT) --
            const safeParse = (key, fallback) => {
                try {
                    const item = localStorage.getItem(key);
                    return item ? JSON.parse(item) : fallback;
                } catch (e) { 
                    console.warn("Corrupted data for", key);
                    return fallback; 
                }
            };

            const [history, setHistory] = useState(() => {
                const h = safeParse('elite_history', []);
                if (h.length === 0) return safeParse('eliteHybrid_history', []); // Fallback V7
                return h;
            });

            const [userStats, setUserStats] = useState(() => safeParse('elite_userStats', { bodyWeight: '', lastWeighIn: null, energy: 3 }));
            
            const [programs, setPrograms] = useState(() => {
                const defaults = {
                    PUSH: { id: 'PUSH', title: "Séance Push", color: "from-blue-600 to-cyan-500", exercises: [
                        { id: 'p1', name: 'Développé Couché Barre', sets: '6', reps: '5', target: 'Force' },
                        { id: 'p2', name: 'Développé Couché Incliné', sets: '3', reps: '10', target: 'Haut Pecs' },
                        { id: 'p3', name: 'Écarté Couché Haltères', sets: '3', reps: '10', target: 'Isolation' },
                        { id: 'p4', name: 'Extension Triceps', sets: '3', reps: '10', target: 'Triceps' },
                        { id: 'p5', name: 'Développé Triceps', sets: '3', reps: '10', target: 'Finition' }
                    ]},
                    PULL: { id: 'PULL', title: "Séance Pull", color: "from-emerald-600 to-teal-500", exercises: [
                        { id: 'pu1', name: 'Rowing Barre', sets: '6', reps: '5', target: 'Dos' },
                        { id: 'pu2', name: 'Tirage Vertical', sets: '3', reps: '10', target: 'Largeur' },
                        { id: 'pu3', name: 'Tractions', sets: '3', reps: '10', target: 'Dos' },
                        { id: 'pu4', name: 'Curl Pupitre', sets: '3', reps: '10', target: 'Biceps' },
                        { id: 'pu5', name: 'Curl Incliné', sets: '3', reps: '10', target: 'Biceps Long' }
                    ]},
                    HYBRID: { id: 'HYBRID', title: "Séance Crossfit & Legs", color: "from-orange-600 to-red-500", isCircuit: true, circuit: { name: "Le Circuit Infernal", description: "Rowing / SDT / Crunch / Squat" }, isolation: [
                        { id: 'h1', name: 'Leg Curl', sets: '3', reps: '10', target: 'Ischios' },
                        { id: 'h2', name: 'Leg Extension', sets: '3', reps: '10', target: 'Quads' }
                    ]}
                };
                
                const saved = safeParse('elite_programs', null);
                if (saved) {
                    // Vérification de structure pour éviter écran blanc
                    if (!saved.HYBRID) return { ...saved, HYBRID: defaults.HYBRID };
                    return saved;
                }
                return defaults;
            });

            // -- ÉTATS UI --
            const [activeTab, setActiveTab] = useState('dashboard');
            const [selectedSessionType, setSelectedSessionType] = useState(() => localStorage.getItem('elite_selectedSessionType') || null);
            const [sessionLogs, setSessionLogs] = useState(() => safeParse('elite_currentSessionLogs', {}));
            const [circuitRounds, setCircuitRounds] = useState(() => localStorage.getItem('elite_circuitRounds') || '');
            
            const [isEditMode, setIsEditMode] = useState(false);
            const [expandedHistoryId, setExpandedHistoryId] = useState(null);
            const [newExoName, setNewExoName] = useState("");
            const [showProgramModal, setShowProgramModal] = useState(false);
            const [newProgramTitle, setNewProgramTitle] = useState("");
            const [showSummary, setShowSummary] = useState(false);
            const [lastSessionSummary, setLastSessionSummary] = useState(null);
            const [analyticsExo, setAnalyticsExo] = useState(null);
            
            // Modal Transfert
            const [showBackupModal, setShowBackupModal] = useState(false);
            const [importString, setImportString] = useState("");

            // -- SAUVEGARDE --
            useEffect(() => { 
                if(selectedSessionType) localStorage.setItem('elite_selectedSessionType', selectedSessionType);
                else localStorage.removeItem('elite_selectedSessionType');
            }, [selectedSessionType]);
            useEffect(() => { localStorage.setItem('elite_userStats', JSON.stringify(userStats)); }, [userStats]);
            useEffect(() => { localStorage.setItem('elite_currentSessionLogs', JSON.stringify(sessionLogs)); }, [sessionLogs]);
            useEffect(() => { localStorage.setItem('elite_circuitRounds', circuitRounds); }, [circuitRounds]);
            useEffect(() => { localStorage.setItem('elite_programs', JSON.stringify(programs)); }, [programs]);
            useEffect(() => { localStorage.setItem('elite_history', JSON.stringify(history)); }, [history]);

            // -- LOGIQUE --
            const updateSetData = (exId, setIndex, field, value) => {
                setSessionLogs(prev => {
                    const currentExLogs = prev[exId] ? [...prev[exId]] : [];
                    if (!currentExLogs[setIndex]) currentExLogs[setIndex] = {}; 
                    currentExLogs[setIndex] = { ...currentExLogs[setIndex], [field]: value };
                    return { ...prev, [exId]: currentExLogs };
                });
            };

            const getBestSetVolume = (sets) => {
                if (!sets || sets.length === 0) return 0;
                return sets.reduce((max, s) => {
                    const vol = (parseFloat(s?.weight) || 0) * (parseFloat(s?.reps) || 0);
                    return vol > max ? vol : max;
                }, 0);
            };

            const getProgressionStatus = (exId) => {
                const currentLogs = sessionLogs[exId];
                if (!currentLogs || currentLogs.length === 0) return null;
                const currentBestVol = getBestSetVolume(currentLogs);
                if (currentBestVol === 0) return null;

                const lastSessionWithExo = history.slice().reverse().find(h => h.exercises && h.exercises.some(e => e.id === exId));
                if (!lastSessionWithExo) return 'neutral'; 

                const lastExoData = lastSessionWithExo.exercises.find(e => e.id === exId);
                let lastBestVol = 0;
                if (lastExoData.setsData && lastExoData.setsData.length > 0) {
                    lastBestVol = getBestSetVolume(lastExoData.setsData);
                } else {
                    lastBestVol = (lastExoData.weight || 0) * (lastExoData.reps || 0);
                }

                if (currentBestVol > lastBestVol) return 'better';
                if (currentBestVol < lastBestVol) return 'worse';
                return 'neutral';
            };

            const handleFinishSession = () => {
                if (!selectedSessionType) return;
                const prog = programs[selectedSessionType];
                if (!prog) { setSelectedSessionType(null); return; }
                let recordsBroken = 0;
                
                const processExercises = (exList) => {
                    return exList.map(ex => {
                        const logs = sessionLogs[ex.id] || [];
                        const validLogs = logs.filter(l => l && (l.weight || l.reps));
                        const maxWeight = validLogs.length > 0 ? Math.max(...validLogs.map(l => parseFloat(l.weight) || 0)) : 0;
                        const status = getProgressionStatus(ex.id);
                        if (status === 'better') recordsBroken++;
                        return { id: ex.id, name: ex.name, setsData: validLogs, weight: maxWeight };
                    });
                };

                let processedExercises = [];
                let circuitInfo = null;

                if (prog.isCircuit) {
                    circuitInfo = { rounds: parseFloat(circuitRounds) || 0 };
                    processedExercises = processExercises(prog.isolation || []);
                } else {
                    processedExercises = processExercises(prog.exercises || []);
                }

                const newLog = { 
                    id: Date.now(), 
                    date: new Date().toLocaleDateString('fr-FR', { day: 'numeric', month: 'short' }), 
                    type: selectedSessionType, 
                    typeLabel: prog.title, 
                    bodyWeight: userStats.bodyWeight, 
                    energy: userStats.energy, 
                    exercises: processedExercises, 
                    circuit: circuitInfo 
                };
                
                const newHistory = [...history, newLog];
                setHistory(newHistory);
                
                setLastSessionSummary({ log: newLog, records: recordsBroken, mainExerciseId: processedExercises.length > 0 ? processedExercises[0].id : null });
                setShowSummary(true);
                setSessionLogs({}); setCircuitRounds(''); setSelectedSessionType(null); localStorage.removeItem('elite_selectedSessionType'); 
            };

            const addExerciseToProgram = (progId) => {
                if (!newExoName) return;
                const updatedPrograms = { ...programs };
                const prog = updatedPrograms[progId];
                const newExo = { id: `new_${Date.now()}`, name: newExoName, sets: 3, reps: 10 };
                if (prog.isCircuit) { if(!prog.isolation) prog.isolation = []; prog.isolation.push(newExo); } 
                else prog.exercises.push(newExo);
                setPrograms(updatedPrograms); setNewExoName("");
            };

            const removeExerciseFromProgram = (progId, exId) => {
                if(!confirm("Supprimer ?")) return;
                const updatedPrograms = { ...programs };
                const prog = updatedPrograms[progId];
                if (prog.isCircuit) prog.isolation = prog.isolation.filter(e => e.id !== exId);
                else prog.exercises = prog.exercises.filter(e => e.id !== exId);
                setPrograms(updatedPrograms);
            };

            // IMPORT / EXPORT
            const handleExport = () => {
                const data = JSON.stringify({ history, programs, userStats });
                navigator.clipboard.writeText(data).then(() => alert("Données copiées !"));
            };

            const handleImport = () => {
                try {
                    const data = JSON.parse(importString);
                    if(data.history) setHistory(data.history);
                    if(data.programs) setPrograms(data.programs);
                    if(data.userStats) setUserStats(data.userStats);
                    alert("Succès !"); setShowBackupModal(false);
                } catch(e) { alert("Format invalide"); }
            };

            // --- VUES ---
            const renderDashboard = () => React.createElement("div", { className: "p-4 space-y-6 animate-fadeIn pb-24" },
                React.createElement("div", { className: "flex justify-between items-center bg-slate-900 border border-slate-800 p-3 rounded-xl" },
                    React.createElement("h2", { className: "text-white font-bold flex items-center gap-2" }, React.createElement(Database, { size: 18, className: "text-blue-400" }), " Données"),
                    React.createElement("button", { onClick: () => setShowBackupModal(true), className: "bg-blue-600 text-white text-xs font-bold px-3 py-2 rounded-lg" }, "Sauvegarde/Transfert")
                ),
                React.createElement("div", { className: "space-y-3" }, 
                    React.createElement("div", { className: "flex justify-between items-center" }, React.createElement("h3", { className: "text-gray-500 text-xs font-bold uppercase ml-1" }, "Mes Programmes"), React.createElement("button", { onClick: () => setShowProgramModal(true), className: "bg-blue-600/20 text-blue-400 p-1 rounded" }, React.createElement(Plus, { size: 16 }))),
                    Object.entries(programs).map(([key, prog]) => React.createElement("div", { key: key, className: "relative group" }, 
                        React.createElement("button", { onClick: () => { setSelectedSessionType(key); setActiveTab('session'); }, className: `w-full p-4 rounded-xl bg-gradient-to-r ${prog.color} text-white font-bold shadow-lg flex justify-between items-center text-left` }, 
                            React.createElement("div", null, React.createElement("span", null, prog.title), React.createElement("p", { className: "text-[10px] opacity-70 font-normal mt-1" }, prog.isCircuit ? "Circuit" : `${((prog.isCircuit ? prog.isolation : prog.exercises) || []).length} Exercices`)), React.createElement(ArrowRight, { className: "opacity-60" })
                        ),
                        React.createElement("button", { onClick: (e) => { e.stopPropagation(); if(confirm("Supprimer ?")) { const u = {...programs}; delete u[key]; setPrograms(u); }}, className: "absolute top-2 right-2 p-2 bg-black/20 rounded-full text-white" }, React.createElement(Trash2, { size: 14 }))
                    ))
                )
            );

            const renderSession = () => {
                const prog = programs[selectedSessionType];
                if (!prog) return null;
                const exercisesList = prog.isCircuit ? (prog.isolation || []) : (prog.exercises || []);
                return React.createElement("div", { className: "p-4 pb-24 animate-slideIn" },
                    React.createElement("div", { className: "mb-6 flex justify-between items-start" }, 
                        React.createElement("div", null, React.createElement("button", { onClick: () => { setSelectedSessionType(null); setIsEditMode(false); }, className: "text-xs text-gray-500 mb-2" }, "← Retour"), React.createElement("h2", { className: "text-2xl font-bold text-white leading-tight" }, prog.title)),
                        React.createElement("button", { onClick: () => setIsEditMode(!isEditMode), className: `p-2 rounded-full ${isEditMode ? 'bg-blue-600 text-white' : 'bg-slate-800 text-gray-400'}` }, React.createElement(Settings, { size: 18 }))
                    ),
                    React.createElement("div", { className: "space-y-6" }, 
                        prog.isCircuit && React.createElement("div", { className: "bg-slate-900 border border-orange-900/50 p-5 rounded-xl shadow-lg" }, React.createElement("h3", { className: "text-lg font-bold text-orange-400 flex items-center gap-2 mb-2" }, React.createElement(Flame, { fill: "currentColor" }), " ", prog.circuit.name), React.createElement("div", { className: "bg-black/50 p-4 rounded-lg text-center" }, React.createElement("label", { className: "text-xs text-gray-500 uppercase font-bold block mb-2" }, "Tours validés"), React.createElement("input", { type: "number", value: circuitRounds, onChange: (e) => setCircuitRounds(e.target.value), placeholder: "0", className: "bg-transparent text-center text-4xl font-black text-white w-full focus:outline-none" }))), 
                        exercisesList.map(ex => {
                            const setList = Array.from({ length: parseInt(ex.sets) || 3 });
                            const status = getProgressionStatus(ex.id);
                            return React.createElement("div", { key: ex.id, className: "bg-slate-900 border border-slate-800 rounded-xl overflow-hidden relative" },
                                isEditMode && React.createElement("button", { onClick: () => removeExerciseFromProgram(selectedSessionType, ex.id), className: "absolute top-2 right-2 bg-red-900/80 text-white p-1 rounded-full z-10" }, React.createElement(Trash2, { size: 14 })),
                                React.createElement("div", { className: "bg-slate-800/50 p-3 flex justify-between items-center" }, 
                                    isEditMode ? React.createElement("input", { value: ex.name, onChange: (e) => { const u = {...programs}; (prog.isCircuit ? u[selectedSessionType].isolation : u[selectedSessionType].exercises).find(x => x.id === ex.id).name = e.target.value; setPrograms(u); }, className: "bg-black border border-slate-600 rounded p-1 text-sm text-white w-full mr-8" }) 
                                    : React.createElement("div", { className: "flex items-center gap-2" }, React.createElement("h3", { className: "font-bold text-gray-200 text-sm" }, ex.name), status === 'better' && React.createElement(TrendingUp, { size: 16, className: "text-green-500" }), status === 'worse' && React.createElement(TrendingDown, { size: 16, className: "text-red-500" }), status === 'neutral' && React.createElement(Minus, { size: 16, className: "text-gray-500" })),
                                    !isEditMode && React.createElement("span", { className: "text-[10px] text-gray-400 bg-slate-800 px-2 py-1 rounded" }, `${ex.sets}x${ex.reps}`)
                                ),
                                React.createElement("div", { className: "p-2 space-y-2" },
                                    React.createElement("div", { className: "grid grid-cols-8 gap-1 text-[9px] uppercase text-gray-500 font-bold px-2 text-center" }, React.createElement("div", { className: "col-span-1" }, "#"), React.createElement("div", { className: "col-span-4" }, "Kg"), React.createElement("div", { className: "col-span-3" }, "Reps")),
                                    setList.map((_, idx) => {
                                        const currentVal = sessionLogs[ex.id] && sessionLogs[ex.id][idx] ? sessionLogs[ex.id][idx] : {};
                                        return React.createElement("div", { key: idx, className: "grid grid-cols-8 gap-1 items-center" },
                                            React.createElement("div", { className: "col-span-1 flex justify-center" }, React.createElement("div", { className: "w-6 h-6 rounded-full bg-slate-800 flex items-center justify-center text-xs text-gray-400 font-bold" }, idx + 1)),
                                            React.createElement("div", { className: "col-span-4" }, React.createElement("input", { type: "number", placeholder: "-", value: currentVal.weight || '', onChange: (e) => updateSetData(ex.id, idx, 'weight', e.target.value), className: "w-full bg-black border border-slate-700 rounded p-2 text-center text-white font-bold focus:border-blue-500 outline-none text-sm" })),
                                            React.createElement("div", { className: "col-span-3" }, React.createElement("input", { type: "number", placeholder: "-", value: currentVal.reps || '', onChange: (e) => updateSetData(ex.id, idx, 'reps', e.target.value), className: "w-full bg-black border border-slate-700 rounded p-2 text-center text-blue-400 font-bold focus:border-blue-500 outline-none text-sm" }))
                                        );
                                    })
                                )
                            );
                        }),
                        isEditMode && React.createElement("div", { className: "bg-slate-800/50 p-4 rounded-xl border border-dashed border-slate-600 flex gap-2" }, React.createElement("input", { placeholder: "Nouvel exercice...", value: newExoName, onChange: e => setNewExoName(e.target.value), className: "flex-1 bg-black border border-slate-600 rounded p-2 text-sm text-white" }), React.createElement("button", { onClick: () => addExerciseToProgram(selectedSessionType), className: "bg-blue-600 text-white px-4 rounded font-bold text-sm" }, "+"))
                    ),
                    React.createElement("button", { onClick: handleFinishSession, className: "w-full mt-8 bg-white text-black font-black py-4 rounded-xl shadow-xl flex items-center justify-center gap-2 hover:bg-gray-200" }, React.createElement(Save, { size: 20 }), " TERMINER")
                );
            };

            // BACKUP MODAL
            const renderBackupModal = () => React.createElement("div", { className: "fixed inset-0 bg-black/95 z-50 flex flex-col items-center justify-center p-6" },
                React.createElement("div", { className: "bg-slate-900 w-full max-w-md rounded-2xl border border-slate-700 p-6 space-y-6" },
                    React.createElement("div", { className: "flex justify-between items-center" }, React.createElement("h3", { className: "text-white font-bold text-lg" }, "Transfert Données"), React.createElement("button", { onClick: () => setShowBackupModal(false) }, React.createElement(X, { className: "text-gray-400" }))),
                    React.createElement("div", { className: "space-y-4" },
                        React.createElement("button", { onClick: handleExport, className: "w-full bg-slate-800 hover:bg-slate-700 text-white p-4 rounded-xl flex items-center justify-between border border-slate-600" }, React.createElement("span", { className: "flex items-center gap-2" }, React.createElement(Copy, { size: 18 }), " Copier mes données"), React.createElement("span", { className: "text-xs bg-blue-900 text-blue-300 px-2 py-1 rounded" }, "COPIER")),
                        React.createElement("div", { className: "border-t border-slate-800 pt-4" },
                            React.createElement("p", { className: "text-sm text-gray-400 mb-2" }, "Coller ici pour restaurer :"),
                            React.createElement("textarea", { value: importString, onChange: e => setImportString(e.target.value), className: "w-full bg-black border border-slate-700 rounded-xl p-3 text-xs text-gray-300 h-24 mb-2 font-mono", placeholder: "Collez le code..." }),
                            React.createElement("button", { onClick: handleImport, className: "w-full bg-blue-600 hover:bg-blue-500 text-white font-bold p-3 rounded-xl flex items-center justify-center gap-2" }, React.createElement(Upload, { size: 18 }), " IMPORTER")
                        )
                    )
                )
            );

            // OTHER VUES (Summary, Analytics, History, etc... same logic)
            const renderSummary = () => {
                if (!lastSessionSummary) return null;
                return React.createElement("div", { className: "fixed inset-0 bg-black/95 z-50 overflow-y-auto animate-fadeIn" },
                    React.createElement("div", { className: "p-6 min-h-screen flex flex-col items-center justify-center text-center space-y-6" },
                        React.createElement(Trophy, { size: 64, className: "text-yellow-400 animate-pop" }),
                        React.createElement("h2", { className: "text-3xl font-black text-white italic" }, "SÉANCE TERMINÉE"),
                        React.createElement("div", { className: "grid grid-cols-2 gap-4 w-full" },
                            React.createElement("div", { className: "bg-slate-900 p-4 rounded-xl border border-slate-800" }, React.createElement("p", { className: "text-xs text-gray-500 uppercase" }, "Records"), React.createElement("p", { className: "text-2xl font-bold text-green-400" }, `+${lastSessionSummary.records}`)),
                            React.createElement("div", { className: "bg-slate-900 p-4 rounded-xl border border-slate-800" }, React.createElement("p", { className: "text-xs text-gray-500 uppercase" }, "Exercices"), React.createElement("p", { className: "text-2xl font-bold text-white" }, lastSessionSummary.log.exercises.length))
                        ),
                        React.createElement("button", { onClick: () => { setShowSummary(false); setActiveTab('dashboard'); }, className: "w-full bg-white text-black font-black py-4 rounded-xl shadow-xl hover:bg-gray-200 mt-4" }, "RETOUR ACCUEIL")
                    )
                );
            };

            const renderAnalytics = () => React.createElement("div", { className: "p-4 pb-24" }, React.createElement("h2", { className: "text-2xl font-bold text-white mb-6" }, "Suivi"), React.createElement("div", { className: "text-center text-gray-500" }, "Complétez plus de séances pour voir les stats."));
            
            const renderHistory = () => React.createElement("div", { className: "p-4 space-y-4 pb-24" }, 
                React.createElement("div", { className: "flex justify-between items-center mb-4" }, React.createElement("h2", { className: "text-white font-bold text-xl" }, "Historique"), React.createElement("button", { onClick: () => { if(confirm("Effacer ?")) setHistory([]); }, className: "text-red-500 text-xs flex items-center gap-1 border border-red-900 bg-red-900/10 px-3 py-2 rounded-lg" }, React.createElement(Trash2, { size: 14 }), " Reset")), 
                history.length === 0 ? React.createElement("div", { className: "text-center text-gray-600 py-10" }, "Aucune séance.") : 
                history.slice().reverse().map(h => React.createElement("div", { key: h.id, className: "bg-slate-900 p-4 rounded-xl border-l-4 border-slate-700" }, 
                    React.createElement("div", { className: "flex justify-between items-center", onClick: () => setExpandedHistoryId(expandedHistoryId === h.id ? null : h.id) },
                        React.createElement("div", null, React.createElement("span", { className: "block font-bold text-white" }, h.typeLabel || h.type), React.createElement("span", { className: "text-xs text-gray-400" }, h.date)),
                        React.createElement("div", { className: "flex items-center gap-2" }, h.bodyWeight && React.createElement("span", { className: "text-xs text-pink-400 bg-pink-900/20 px-2 py-1 rounded" }, `${h.bodyWeight}kg`), expandedHistoryId === h.id ? React.createElement(ChevronUp, { size: 16, className: "text-gray-500" }) : React.createElement(ChevronDown, { size: 16, className: "text-gray-500" }))
                    ),
                    expandedHistoryId === h.id && React.createElement("div", { className: "mt-4 pt-4 border-t border-slate-800 space-y-3" },
                        h.circuit && React.createElement("div", { className: "text-orange-400 text-sm font-bold" }, `Circuit : ${h.circuit.rounds} Tours`),
                        h.exercises.map((ex, i) => React.createElement("div", { key: i, className: "text-sm" },
                            React.createElement("div", { className: "font-bold text-gray-300" }, ex.name),
                            ex.setsData ? React.createElement("div", { className: "flex flex-wrap gap-2 mt-1" }, ex.setsData.map((s, j) => React.createElement("span", { key: j, className: "bg-black px-2 py-1 rounded text-xs text-gray-500 border border-slate-800" }, `${s.weight}kg x ${s.reps}`))) : React.createElement("span", { className: "text-xs text-gray-600" }, `Max: ${ex.weight}kg`)
                        ))
                    )
                ))
            );

            // Création Programme Modal
            const renderCreateModal = () => React.createElement("div", { className: "fixed inset-0 bg-black/90 z-50 flex items-center justify-center p-4" },
                React.createElement("div", { className: "bg-slate-900 w-full max-w-md rounded-2xl border border-slate-700 p-6 space-y-4" },
                    React.createElement("h3", { className: "text-white font-bold text-lg" }, "Nouveau Programme"),
                    React.createElement("input", { placeholder: "Nom (ex: Jambes Lourd)", value: newProgramTitle, onChange: e => setNewProgramTitle(e.target.value), className: "w-full bg-black border border-slate-700 rounded p-3 text-white focus:border-blue-500 outline-none" }),
                    React.createElement("div", { className: "flex gap-2" },
                        React.createElement("button", { onClick: () => setShowProgramModal(false), className: "flex-1 text-slate-400 py-3" }, "Annuler"),
                        React.createElement("button", { onClick: () => { if(!newProgramTitle) return; const id=`PROG_${Date.now()}`; setPrograms({...programs, [id]: {id, title: newProgramTitle, color: "from-purple-600 to-indigo-500", exercises: []}}); setNewProgramTitle(""); setShowProgramModal(false); }, className: "flex-1 bg-blue-600 text-white font-bold rounded-xl py-3" }, "Créer")
                    )
                )
            );

            return React.createElement("div", { className: "min-h-screen bg-black text-slate-200 font-sans" },
                React.createElement("div", { className: "bg-slate-950/80 backdrop-blur-md sticky top-0 z-40 px-4 py-3 border-b border-slate-900 flex justify-between items-center" }, React.createElement("h1", { className: "font-black text-lg italic bg-gradient-to-r from-white to-slate-500 bg-clip-text text-transparent" }, "ELITE HYBRID v12"), React.createElement("div", { className: "flex items-center gap-2" }, React.createElement("span", { className: "text-xs font-mono text-gray-500" }, new Date().toLocaleDateString()))),
                React.createElement("div", { className: "mx-auto max-w-md" }, 
                    activeTab === 'dashboard' && !selectedSessionType && renderDashboard(), 
                    activeTab === 'session' && selectedSessionType && renderSession(), 
                    activeTab === 'analysis' && renderAnalytics(), 
                    activeTab === 'history' && renderHistory()
                ),
                showSummary && renderSummary(),
                showProgramModal && renderCreateModal(),
                showBackupModal && renderBackupModal(),
                !selectedSessionType && !showSummary && !showProgramModal && !showBackupModal && React.createElement("div", { className: "fixed bottom-0 left-0 right-0 bg-slate-950 border-t border-slate-900 p-2 flex justify-around pb-6 z-40" }, React.createElement(NavBtn, { icon: React.createElement(Activity, null), label: "Workout", active: activeTab === 'dashboard', onClick: () => setActiveTab('dashboard') }), React.createElement(NavBtn, { icon: React.createElement(TrendingUp, null), label: "Stats", active: activeTab === 'analysis', onClick: () => setActiveTab('analysis') }), React.createElement(NavBtn, { icon: React.createElement(History, null), label: "Journal", active: activeTab === 'history', onClick: () => setActiveTab('history') }))
            );
        }

        function NavBtn({ icon, label, active, onClick }) { return React.createElement("button", { onClick: onClick, className: `flex flex-col items-center p-2 rounded-lg transition-colors ${active ? 'text-white' : 'text-slate-600'}` }, React.cloneElement(icon, { size: 24 }), React.createElement("span", { className: "text-[10px] font-bold uppercase mt-1" }, label)); }
        function ChartCard({ title, color, data, unit }) {
            if (!data || data.length === 0) return null;
            const maxVal = Math.max(...data.map(d => parseFloat(d.val))) || 1;
            return React.createElement("div", { className: "bg-slate-900 p-5 rounded-2xl border border-slate-800" }, React.createElement("div", { className: "flex justify-between items-center mb-6" }, React.createElement("h3", { className: `font-bold ${color}` }, title), React.createElement("span", { className: "text-xs text-gray-500 bg-slate-950 px-2 py-1 rounded border border-slate-800" }, "Récent")), React.createElement("div", { className: "flex items-end justify-between h-32 gap-2" }, data.map((d, i) => { const height = (parseFloat(d.val) / maxVal) * 100; return React.createElement("div", { key: i, className: "flex-1 flex flex-col items-center gap-2 group" }, React.createElement("div", { style: { height: `${height}%` }, className: "w-full bg-slate-600 rounded-t-sm opacity-60 group-hover:opacity-100" }), React.createElement("span", { className: "text-[9px] text-gray-500" }, d.date)); })));
        }

        const root = createRoot(document.getElementById('root'));
        root.render(React.createElement(App));
    </script>
</body>
</html>
