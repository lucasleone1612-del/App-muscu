<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Elite Hybrid Training</title>
    
    <!-- PWA Settings -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#000000">
    <link rel="manifest" href='data:application/manifest+json;base64,eyJuYW1lIjoiRWxpdGUgSHlicmlkIFRyYWluaW5nIiwic2hvcnRfbmFtZSI6IkVsaXRlIEd5bSIsInN0YXJ0X3VybCI6Ii4iLCJkaXNwbGF5Ijoic3RhbmRhbG9uZSIsImJhY2tncm91bmRfY29xvciI6IiMwMDAwMDAiLCJ0aGVtZV9jb2xvciI6IiMwMDAwMDAiLCJpY29ucyI6W3sic3JjIjoiaHR0cHM6Ly9jZG4tanNkZWxpdnIubmV0L2doL2x1Y2lkZS1pY29ucy9sdWNpZGUvbG9nby5zdmciLCJzaXplcyI6IjUxMng1MTIiLCJ0eXBlIjoiaW1hZ2Uvc3ZnK3htbCJ9XX0='>

    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;700;900&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #000; color: #fff; -webkit-tap-highlight-color: transparent; }
        .animate-fadeIn { animation: fadeIn 0.5s ease-out; }
        .animate-slideIn { animation: slideIn 0.3s ease-out; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes slideIn { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        input[type="number"] { -moz-appearance: textfield; }
        input[type="number"]::-webkit-inner-spin-button, input[type="number"]::-webkit-outer-spin-button { -webkit-appearance: none; margin: 0; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script>
        if ('serviceWorker' in navigator) {
            const swCode = `
                const CACHE_NAME = 'elite-gym-v8-fix';
                const urlsToCache = [
                    'https://cdn.tailwindcss.com',
                    'https://fonts.googleapis.com/css2?family=Inter:wght@300;400;700;900&display=swap',
                    'https://esm.sh/react@18.2.0',
                    'https://esm.sh/react-dom@18.2.0/client',
                    'https://esm.sh/lucide-react@0.263.1'
                ];
                self.addEventListener('install', event => { self.skipWaiting(); event.waitUntil(caches.open(CACHE_NAME).then(cache => Promise.all(urlsToCache.map(url => fetch(url, { mode: 'cors' }).then(res => { if (res.ok) cache.put(url, res); }).catch(e => console.log('Cache fail:', url)))))); });
                self.addEventListener('fetch', event => { event.respondWith(caches.match(event.request).then(response => { if (response) return response; return fetch(event.request).then(networkResponse => { if (!networkResponse || networkResponse.status !== 200 || networkResponse.type !== 'basic' && networkResponse.type !== 'cors') return networkResponse; const responseToCache = networkResponse.clone(); caches.open(CACHE_NAME).then(cache => { if(event.request.url.startsWith('http')) cache.put(event.request, responseToCache); }); return networkResponse; }).catch(() => null); })); });
            `;
            try {
                const blob = new Blob([swCode], { type: 'text/javascript' });
                const swUrl = URL.createObjectURL(blob);
                window.addEventListener('load', () => { if (window.location.protocol === 'https:' || window.location.hostname === 'localhost') { navigator.serviceWorker.register(swUrl).catch(e => {}); } });
            } catch (e) {}
        }
    </script>

    <script type="module">
        import React, { useState, useEffect, useMemo } from 'https://esm.sh/react@18.2.0';
        import { createRoot } from 'https://esm.sh/react-dom@18.2.0/client';
        import { 
            Save, Activity, TrendingUp, TrendingDown, Scale, Calendar, 
            ChevronDown, ChevronUp, BarChart2, Dumbbell, History, 
            Flame, BatteryCharging, ArrowRight,
            Plus, Trash2, X, Settings, Edit2, CheckCircle
        } from 'https://esm.sh/lucide-react@0.263.1';

        function App() {
            // -- RESTAURATION DONNÉES & MIGRATION --
            
            // 1. Historique : On cherche la V8, sinon on récupère la V7 (Legacy)
            const [history, setHistory] = useState(() => {
                const newKey = localStorage.getItem('elite_history');
                if (newKey) return JSON.parse(newKey);
                
                // MIGRATION : On va chercher les données de l'ancienne version
                const oldKey = localStorage.getItem('eliteHybrid_history');
                if (oldKey) {
                    console.log("Migration réussie : Historique retrouvé !");
                    return JSON.parse(oldKey);
                }
                return [];
            });

            // 2. Stats User
            const [userStats, setUserStats] = useState(() => {
                const newStats = localStorage.getItem('elite_userStats');
                if (newStats) return JSON.parse(newStats);
                const oldStats = localStorage.getItem('eliteHybrid_userStats');
                return oldStats ? JSON.parse(oldStats) : { bodyWeight: '', lastWeighIn: null, energy: 3 };
            });

            // 3. Programmes (Merge défaut + custom ancien)
            const [programs, setPrograms] = useState(() => {
                const saved = localStorage.getItem('elite_programs');
                if (saved) return JSON.parse(saved);

                const defaults = {
                    PUSH: { id: 'PUSH', title: "Séance Push", color: "from-blue-600 to-cyan-500", exercises: [
                        { id: 'p1', name: 'Développé Couché Barre', sets: '6', reps: '5', target: 'Force' },
                        { id: 'p2', name: 'Développé Couché Incliné', sets: '3', reps: '10', target: 'Haut Pecs' },
                        { id: 'p3', name: 'Écarté Couché Haltères', sets: '3', reps: '10', target: 'Isolation' },
                        { id: 'p4', name: 'Extension Triceps Barre EZ', sets: '3', reps: '10', target: 'Triceps' },
                        { id: 'p5', name: 'Développé Triceps', sets: '3', reps: '10', target: 'Finition' }
                    ]},
                    PULL: { id: 'PULL', title: "Séance Pull", color: "from-emerald-600 to-teal-500", exercises: [
                        { id: 'pu1', name: 'Rowing Barre', sets: '6', reps: '5', target: 'Dos' },
                        { id: 'pu2', name: 'Tirage Vertical', sets: '3', reps: '10', target: 'Largeur' },
                        { id: 'pu3', name: 'Tractions', sets: '3', reps: '10', target: 'Poids du corps' },
                        { id: 'pu4', name: 'Curl Pupitre', sets: '3', reps: '10', target: 'Biceps' },
                        { id: 'pu5', name: 'Curl Incliné', sets: '3', reps: '10', target: 'Biceps Long' }
                    ]},
                    HYBRID: { id: 'HYBRID', title: "Séance Crossfit & Legs", color: "from-orange-600 to-red-500", isCircuit: true, circuit: { name: "Le Circuit Infernal", description: "Rowing / SDT / Crunch / Squat" }, isolation: [
                        { id: 'h1', name: 'Leg Curl', sets: '3', reps: '10', target: 'Ischios' },
                        { id: 'h2', name: 'Leg Extension', sets: '3', reps: '10', target: 'Quads' }
                    ]}
                };

                // Récupération des programmes customs V7
                const oldCustoms = localStorage.getItem('eliteHybrid_customPrograms');
                if (oldCustoms) {
                    try {
                        const parsedOld = JSON.parse(oldCustoms);
                        return { ...defaults, ...parsedOld };
                    } catch(e) { return defaults; }
                }
                return defaults;
            });

            // -- ÉTATS INTERFACE --
            const [activeTab, setActiveTab] = useState(() => localStorage.getItem('elite_activeTab') || 'dashboard');
            const [selectedSessionType, setSelectedSessionType] = useState(() => localStorage.getItem('elite_selectedSessionType') || null);
            const [sessionLogs, setSessionLogs] = useState(() => JSON.parse(localStorage.getItem('elite_currentSessionLogs')) || {});
            const [circuitRounds, setCircuitRounds] = useState(() => localStorage.getItem('elite_circuitRounds') || '');
            
            const [isEditMode, setIsEditMode] = useState(false);
            const [expandedHistoryId, setExpandedHistoryId] = useState(null);
            const [newExoName, setNewExoName] = useState("");
            const [showCreateModal, setShowCreateModal] = useState(false); // Gardé pour compatibilité mais moins utile avec edit mode

            // -- EFFETS DE SAUVEGARDE CONTINUE --
            useEffect(() => { localStorage.setItem('elite_activeTab', activeTab); }, [activeTab]);
            useEffect(() => { 
                if(selectedSessionType) localStorage.setItem('elite_selectedSessionType', selectedSessionType);
                else localStorage.removeItem('elite_selectedSessionType');
            }, [selectedSessionType]);
            useEffect(() => { localStorage.setItem('elite_userStats', JSON.stringify(userStats)); }, [userStats]);
            useEffect(() => { localStorage.setItem('elite_currentSessionLogs', JSON.stringify(sessionLogs)); }, [sessionLogs]);
            useEffect(() => { localStorage.setItem('elite_circuitRounds', circuitRounds); }, [circuitRounds]);
            useEffect(() => { localStorage.setItem('elite_programs', JSON.stringify(programs)); }, [programs]);
            useEffect(() => { localStorage.setItem('elite_history', JSON.stringify(history)); }, [history]);

            // -- LOGIQUE MÉTIER --

            const updateSetData = (exId, setIndex, field, value) => {
                setSessionLogs(prev => {
                    const currentExLogs = prev[exId] ? [...prev[exId]] : [];
                    if (!currentExLogs[setIndex]) currentExLogs[setIndex] = {}; 
                    currentExLogs[setIndex] = { ...currentExLogs[setIndex], [field]: value };
                    return { ...prev, [exId]: currentExLogs };
                });
            };

            // Comparateur Intelligent (Vert/Rouge)
            const getProgressionStatus = (exId) => {
                const currentLogs = sessionLogs[exId];
                if (!currentLogs || currentLogs.length === 0) return null;

                // Calcul du Volume Actuel (Total Kg * Reps)
                const currentVolume = currentLogs.reduce((acc, log) => acc + ((parseFloat(log?.weight)||0) * (parseFloat(log?.reps)||0)), 0);
                if (currentVolume === 0) return null;

                // Chercher le dernier volume historique pour cet exo
                const lastSessionWithExo = history.slice().reverse().find(h => h.exercises.some(e => e.id === exId));
                if (!lastSessionWithExo) return 'neutral'; 

                const lastExoData = lastSessionWithExo.exercises.find(e => e.id === exId);
                let lastVolume = 0;
                
                // Compatible avec ancien (weight simple) et nouveau (setsData) format
                if (lastExoData.setsData && lastExoData.setsData.length > 0) {
                    lastVolume = lastExoData.setsData.reduce((acc, log) => acc + ((parseFloat(log?.weight)||0) * (parseFloat(log?.reps)||0)), 0);
                } else {
                    lastVolume = (lastExoData.weight || 0) * (lastExoData.reps || 10) * (lastExoData.sets || 3); // Approximation si vieilles données
                }

                if (currentVolume > lastVolume) return 'better';
                if (currentVolume < lastVolume) return 'worse';
                return 'neutral';
            };

            const handleFinishSession = () => {
                if (!selectedSessionType) return;
                const prog = programs[selectedSessionType];
                const newLog = { 
                    id: Date.now(), 
                    date: new Date().toLocaleDateString('fr-FR', { day: 'numeric', month: 'short' }), 
                    type: selectedSessionType, 
                    typeLabel: prog.title, 
                    bodyWeight: userStats.bodyWeight, 
                    energy: userStats.energy, 
                    exercises: [], 
                    circuit: null 
                };
                
                const processExercises = (exList) => {
                    return exList.map(ex => {
                        const logs = sessionLogs[ex.id] || [];
                        const validLogs = logs.filter(l => l && (l.weight || l.reps));
                        const maxWeight = validLogs.length > 0 ? Math.max(...validLogs.map(l => parseFloat(l.weight) || 0)) : 0;
                        return { id: ex.id, name: ex.name, setsData: validLogs, weight: maxWeight };
                    });
                };

                if (prog.isCircuit) {
                    newLog.circuit = { rounds: parseFloat(circuitRounds) || 0 };
                    newLog.exercises = processExercises(prog.isolation);
                } else {
                    newLog.exercises = processExercises(prog.exercises);
                }
                
                setHistory([...history, newLog]);
                setSessionLogs({}); 
                setCircuitRounds(''); 
                setSelectedSessionType(null); 
                localStorage.removeItem('elite_selectedSessionType'); // Clean exit
                setActiveTab('analysis'); 
            };

            const updateExerciseName = (progId, exId, newName) => {
                const updatedPrograms = { ...programs };
                const prog = updatedPrograms[progId];
                const list = prog.isCircuit && !prog.exercises ? prog.isolation : prog.exercises;
                const exo = list.find(e => e.id === exId);
                if (exo) exo.name = newName;
                setPrograms(updatedPrograms);
            };

            const addExerciseToProgram = (progId) => {
                if (!newExoName) return;
                const updatedPrograms = { ...programs };
                const prog = updatedPrograms[progId];
                const newExo = { id: `new_${Date.now()}`, name: newExoName, sets: 3, reps: 10, target: 'Custom' };
                if (prog.isCircuit && !prog.exercises) prog.isolation.push(newExo);
                else prog.exercises.push(newExo);
                setPrograms(updatedPrograms);
                setNewExoName("");
            };

            const removeExerciseFromProgram = (progId, exId) => {
                if(!confirm("Supprimer cet exercice ?")) return;
                const updatedPrograms = { ...programs };
                const prog = updatedPrograms[progId];
                if (prog.isCircuit && !prog.exercises) prog.isolation = prog.isolation.filter(e => e.id !== exId);
                else prog.exercises = prog.exercises.filter(e => e.id !== exId);
                setPrograms(updatedPrograms);
            };

            const handleWeighIn = (weight) => { setUserStats({ ...userStats, bodyWeight: weight, lastWeighIn: new Date().toISOString() }); };
            const needsWeighIn = () => { if (!userStats.lastWeighIn || !userStats.bodyWeight) return true; return Math.ceil(Math.abs(new Date() - new Date(userStats.lastWeighIn)) / (1000 * 60 * 60 * 24)) > 7; };
            const resetHistoryData = () => { if (confirm("Effacer tout l'historique ? Cette action est irréversible.")) setHistory([]); };

            // --- VUES ---
            const renderDashboard = () => React.createElement("div", { className: "p-4 space-y-6 animate-fadeIn pb-24" },
                needsWeighIn() ? React.createElement("div", { className: "bg-gradient-to-r from-pink-600 to-rose-500 p-5 rounded-2xl shadow-lg border border-pink-400/30" }, React.createElement("h2", { className: "text-white font-bold flex items-center gap-2 mb-3" }, React.createElement(Scale, { className: "text-white" }), " Pesée Hebdo"), React.createElement("div", { className: "flex gap-2" }, React.createElement("input", { type: "number", placeholder: "Kg", className: "bg-white text-pink-600 font-bold rounded-lg p-2 w-24 text-center focus:outline-none", onBlur: (e) => e.target.value && handleWeighIn(e.target.value) }), React.createElement("button", { className: "text-white text-xs underline opacity-80", onClick: () => handleWeighIn(userStats.bodyWeight || '0') }, "Plus tard"))) : React.createElement("div", { className: "flex items-center justify-between bg-slate-900 border border-slate-800 p-3 rounded-xl" }, React.createElement("div", { className: "flex items-center gap-2 text-gray-400 text-sm" }, React.createElement(Scale, { size: 16 }), " Poids : ", React.createElement("span", { className: "text-white font-bold" }, userStats.bodyWeight, " kg")), React.createElement("button", { onClick: () => setUserStats({...userStats, lastWeighIn: null}), className: "text-xs text-blue-500" }, "Modifier")),
                React.createElement("div", { className: "bg-slate-900 border border-slate-800 p-5 rounded-2xl relative overflow-hidden" }, React.createElement("h2", { className: "text-white font-bold flex items-center gap-2 mb-4" }, React.createElement(BatteryCharging, { className: "text-emerald-400" }), " Forme du jour"), React.createElement("input", { type: "range", min: "1", max: "5", value: userStats.energy, onChange: e => setUserStats({...userStats, energy: parseInt(e.target.value)}), className: "w-full h-2 bg-slate-800 rounded-lg appearance-none cursor-pointer accent-emerald-500" }), React.createElement("div", { className: "text-center text-emerald-400 font-bold mt-2 text-sm" }, `Niveau ${userStats.energy}/5`)),
                React.createElement("div", { className: "space-y-3" }, React.createElement("h3", { className: "text-gray-500 text-xs font-bold uppercase ml-1" }, "Mes Programmes"), Object.entries(programs).map(([key, prog]) => React.createElement("div", { key: key, className: "relative group" }, React.createElement("button", { onClick: () => { setSelectedSessionType(key); setActiveTab('session'); }, className: `w-full p-4 rounded-xl bg-gradient-to-r ${prog.color} text-white font-bold shadow-lg transform transition-all active:scale-95 flex justify-between items-center text-left` }, React.createElement("div", null, React.createElement("span", null, prog.title), React.createElement("p", { className: "text-[10px] opacity-70 font-normal mt-1" }, prog.isCircuit ? "Circuit + Finition" : `${(prog.exercises || []).length} Exercices`)), React.createElement(ArrowRight, { className: "opacity-60" })))) )
            );

            const renderSession = () => {
                const prog = programs[selectedSessionType];
                if (!prog) return null;
                const exercisesList = prog.isCircuit ? prog.isolation : prog.exercises;

                return React.createElement("div", { className: "p-4 pb-24 animate-slideIn" },
                    React.createElement("div", { className: "mb-6 flex justify-between items-start" }, 
                        React.createElement("div", null, 
                            React.createElement("button", { onClick: () => { setSelectedSessionType(null); setIsEditMode(false); }, className: "text-xs text-gray-500 mb-2" }, "← Retour"), 
                            React.createElement("h2", { className: "text-2xl font-bold text-white leading-tight" }, prog.title)
                        ),
                        React.createElement("button", { onClick: () => setIsEditMode(!isEditMode), className: `p-2 rounded-full ${isEditMode ? 'bg-blue-600 text-white' : 'bg-slate-800 text-gray-400'}` }, React.createElement(Settings, { size: 18 }))
                    ),
                    React.createElement("div", { className: "space-y-6" }, 
                        prog.isCircuit && React.createElement("div", { className: "bg-slate-900 border border-orange-900/50 p-5 rounded-xl shadow-lg" }, React.createElement("h3", { className: "text-lg font-bold text-orange-400 flex items-center gap-2 mb-2" }, React.createElement(Flame, { fill: "currentColor" }), " ", prog.circuit.name), React.createElement("div", { className: "bg-black/50 p-4 rounded-lg text-center" }, React.createElement("label", { className: "text-xs text-gray-500 uppercase font-bold block mb-2" }, "Tours validés"), React.createElement("input", { type: "number", value: circuitRounds, onChange: (e) => setCircuitRounds(e.target.value), placeholder: "0", className: "bg-transparent text-center text-4xl font-black text-white w-full focus:outline-none" }))), 
                        exercisesList.map(ex => {
                            const setList = Array.from({ length: parseInt(ex.sets) || 3 });
                            const status = getProgressionStatus(ex.id);
                            return React.createElement("div", { key: ex.id, className: "bg-slate-900 border border-slate-800 rounded-xl overflow-hidden relative" },
                                isEditMode && React.createElement("button", { onClick: () => removeExerciseFromProgram(selectedSessionType, ex.id), className: "absolute top-2 right-2 bg-red-900/80 text-white p-1 rounded-full z-10" }, React.createElement(Trash2, { size: 14 })),
                                React.createElement("div", { className: "bg-slate-800/50 p-3 flex justify-between items-center" }, 
                                    isEditMode ? React.createElement("input", { value: ex.name, onChange: (e) => updateExerciseName(selectedSessionType, ex.id, e.target.value), className: "bg-black border border-slate-600 rounded p-1 text-sm text-white w-full mr-8" }) 
                                    : React.createElement("div", { className: "flex items-center gap-2" },
                                        React.createElement("h3", { className: "font-bold text-gray-200 text-sm" }, ex.name),
                                        status === 'better' && React.createElement(TrendingUp, { size: 16, className: "text-green-500" }),
                                        status === 'worse' && React.createElement(TrendingDown, { size: 16, className: "text-red-500" })
                                    ),
                                    !isEditMode && React.createElement("span", { className: "text-[10px] text-gray-400 bg-slate-800 px-2 py-1 rounded" }, `${ex.sets}x${ex.reps}`)
                                ),
                                React.createElement("div", { className: "p-2 space-y-2" },
                                    React.createElement("div", { className: "grid grid-cols-8 gap-1 text-[9px] uppercase text-gray-500 font-bold px-2 text-center" }, React.createElement("div", { className: "col-span-1" }, "#"), React.createElement("div", { className: "col-span-4" }, "Kg"), React.createElement("div", { className: "col-span-3" }, "Reps")),
                                    setList.map((_, idx) => {
                                        const currentVal = sessionLogs[ex.id] && sessionLogs[ex.id][idx] ? sessionLogs[ex.id][idx] : {};
                                        return React.createElement("div", { key: idx, className: "grid grid-cols-8 gap-1 items-center" },
                                            React.createElement("div", { className: "col-span-1 flex justify-center" }, React.createElement("div", { className: "w-6 h-6 rounded-full bg-slate-800 flex items-center justify-center text-xs text-gray-400 font-bold" }, idx + 1)),
                                            React.createElement("div", { className: "col-span-4" }, React.createElement("input", { type: "number", placeholder: "-", value: currentVal.weight || '', onChange: (e) => updateSetData(ex.id, idx, 'weight', e.target.value), className: "w-full bg-black border border-slate-700 rounded p-2 text-center text-white font-bold focus:border-blue-500 outline-none text-sm" })),
                                            React.createElement("div", { className: "col-span-3" }, React.createElement("input", { type: "number", placeholder: "-", value: currentVal.reps || '', onChange: (e) => updateSetData(ex.id, idx, 'reps', e.target.value), className: "w-full bg-black border border-slate-700 rounded p-2 text-center text-blue-400 font-bold focus:border-blue-500 outline-none text-sm" }))
                                        );
                                    })
                                )
                            );
                        }),
                        isEditMode && React.createElement("div", { className: "bg-slate-800/50 p-4 rounded-xl border border-dashed border-slate-600 flex gap-2" }, React.createElement("input", { placeholder: "Nouvel exercice...", value: newExoName, onChange: e => setNewExoName(e.target.value), className: "flex-1 bg-black border border-slate-600 rounded p-2 text-sm text-white" }), React.createElement("button", { onClick: () => addExerciseToProgram(selectedSessionType), className: "bg-blue-600 text-white px-4 rounded font-bold text-sm" }, "+"))
                    ),
                    React.createElement("button", { onClick: handleFinishSession, className: "w-full mt-8 bg-white text-black font-black py-4 rounded-xl shadow-xl flex items-center justify-center gap-2 hover:bg-gray-200" }, React.createElement(Save, { size: 20 }), " TERMINER")
                );
            };

            const renderAnalytics = () => {
                const getProgression = (exoId) => history.filter(h => h.exercises && h.exercises.find(e => e.id === exoId)).map(h => {
                    const exData = h.exercises.find(e => e.id === exoId);
                    return { date: h.date, val: exData.weight || 0 };
                }).slice(-6);
                const weightProgression = history.filter(h => h.bodyWeight).map(h => ({ date: h.date, val: h.bodyWeight })).slice(-6);
                return React.createElement("div", { className: "p-4 space-y-6 pb-24 animate-fadeIn" }, React.createElement("h2", { className: "text-2xl font-bold text-white mb-6" }, "Suivi Performance"), weightProgression.length > 0 && React.createElement(ChartCard, { title: "Poids de Corps", color: "text-pink-400", data: weightProgression, unit: "kg" }), React.createElement(ChartCard, { title: "Bench Press (Max)", color: "text-blue-400", data: getProgression('p1'), unit: "kg" }), React.createElement(ChartCard, { title: "Rowing Barre (Max)", color: "text-emerald-400", data: getProgression('pu1'), unit: "kg" }));
            };

            const renderHistory = () => React.createElement("div", { className: "p-4 space-y-4 pb-24" }, 
                React.createElement("div", { className: "flex justify-between items-center mb-4" }, React.createElement("h2", { className: "text-white font-bold text-xl" }, "Historique"), React.createElement("button", { onClick: resetHistoryData, className: "text-red-500 text-xs flex items-center gap-1 border border-red-900 bg-red-900/10 px-3 py-2 rounded-lg" }, React.createElement(Trash2, { size: 14 }), " Reset")), 
                history.length === 0 ? React.createElement("div", { className: "text-center text-gray-600 py-10" }, "Aucune séance.") : 
                history.slice().reverse().map(h => React.createElement("div", { key: h.id, className: "bg-slate-900 p-4 rounded-xl border-l-4 border-slate-700" }, 
                    React.createElement("div", { className: "flex justify-between items-center", onClick: () => setExpandedHistoryId(expandedHistoryId === h.id ? null : h.id) },
                        React.createElement("div", null, React.createElement("span", { className: "block font-bold text-white" }, h.typeLabel || h.type), React.createElement("span", { className: "text-xs text-gray-400" }, h.date)),
                        React.createElement("div", { className: "flex items-center gap-2" }, h.bodyWeight && React.createElement("span", { className: "text-xs text-pink-400 bg-pink-900/20 px-2 py-1 rounded" }, `${h.bodyWeight}kg`), expandedHistoryId === h.id ? React.createElement(ChevronUp, { size: 16, className: "text-gray-500" }) : React.createElement(ChevronDown, { size: 16, className: "text-gray-500" }))
                    ),
                    expandedHistoryId === h.id && React.createElement("div", { className: "mt-4 pt-4 border-t border-slate-800 space-y-3" },
                        h.circuit && React.createElement("div", { className: "text-orange-400 text-sm font-bold" }, `Circuit : ${h.circuit.rounds} Tours`),
                        h.exercises.map((ex, i) => React.createElement("div", { key: i, className: "text-sm" },
                            React.createElement("div", { className: "font-bold text-gray-300" }, ex.name),
                            ex.setsData ? React.createElement("div", { className: "flex flex-wrap gap-2 mt-1" }, ex.setsData.map((s, j) => React.createElement("span", { key: j, className: "bg-black px-2 py-1 rounded text-xs text-gray-500 border border-slate-800" }, `${s.weight}kg x ${s.reps}`))) : React.createElement("span", { className: "text-xs text-gray-600" }, `Max: ${ex.weight}kg`)
                        ))
                    )
                ))
            );

            return React.createElement("div", { className: "min-h-screen bg-black text-slate-200 font-sans" },
                React.createElement("div", { className: "bg-slate-950/80 backdrop-blur-md sticky top-0 z-40 px-4 py-3 border-b border-slate-900 flex justify-between items-center" }, React.createElement("h1", { className: "font-black text-lg italic bg-gradient-to-r from-white to-slate-500 bg-clip-text text-transparent" }, "ELITE HYBRID v8"), React.createElement("div", { className: "flex items-center gap-2" }, React.createElement("span", { className: "text-xs font-mono text-gray-500" }, new Date().toLocaleDateString()))),
                React.createElement("div", { className: "mx-auto max-w-md" }, activeTab === 'dashboard' && !selectedSessionType && renderDashboard(), activeTab === 'session' && selectedSessionType && renderSession(), activeTab === 'analysis' && renderAnalytics(), activeTab === 'history' && renderHistory()),
                !selectedSessionType && !showCreateModal && React.createElement("div", { className: "fixed bottom-0 left-0 right-0 bg-slate-950 border-t border-slate-900 p-2 flex justify-around pb-6 z-40" }, React.createElement(NavBtn, { icon: React.createElement(Activity, null), label: "Workout", active: activeTab === 'dashboard', onClick: () => setActiveTab('dashboard') }), React.createElement(NavBtn, { icon: React.createElement(TrendingUp, null), label: "Stats", active: activeTab === 'analysis', onClick: () => setActiveTab('analysis') }), React.createElement(NavBtn, { icon: React.createElement(History, null), label: "Journal", active: activeTab === 'history', onClick: () => setActiveTab('history') }))
            );
        }

        function NavBtn({ icon, label, active, onClick }) { return React.createElement("button", { onClick: onClick, className: `flex flex-col items-center p-2 rounded-lg transition-colors ${active ? 'text-white' : 'text-slate-600'}` }, React.cloneElement(icon, { size: 24 }), React.createElement("span", { className: "text-[10px] font-bold uppercase mt-1" }, label)); }
        function ChartCard({ title, color, data, unit }) {
            if (!data || data.length === 0) return null;
            const maxVal = Math.max(...data.map(d => parseFloat(d.val))) || 1;
            return React.createElement("div", { className: "bg-slate-900 p-5 rounded-2xl border border-slate-800" }, React.createElement("div", { className: "flex justify-between items-center mb-6" }, React.createElement("h3", { className: `font-bold ${color}` }, title), React.createElement("span", { className: "text-xs text-gray-500 bg-slate-950 px-2 py-1 rounded border border-slate-800" }, "Récent")), React.createElement("div", { className: "flex items-end justify-between h-32 gap-2" }, data.map((d, i) => { const height = (parseFloat(d.val) / maxVal) * 100; return React.createElement("div", { key: i, className: "flex-1 flex flex-col items-center gap-2 group" }, React.createElement("div", { style: { height: `${height}%` }, className: "w-full bg-slate-600 rounded-t-sm opacity-60 group-hover:opacity-100" }), React.createElement("span", { className: "text-[9px] text-gray-500" }, d.date)); })));
        }

        const root = createRoot(document.getElementById('root'));
        root.render(React.createElement(App));
    </script>
</body>
</html>
